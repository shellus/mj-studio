# 网站测试探索记录

本文档记录使用 Playwright 对网站进行探索性测试的过程和发现。

## 测试环境

- **测试地址**：http://111.170.19.56:3000
- **测试日期**：2026-01-28 ~ 2026-01-29
- **登录状态**：已登录（有真实数据）

## 页面探索进度

### 已完成

| 页面 | 路由 | 状态 | 备注 |
|------|------|------|------|
| 首页 | `/` | 正常 | 未登录落地页 |
| 对话 | `/chat` | 正常 | 助手列表、对话列表、输入框 |
| 创作工作台 | `/studio` | 正常 | 图片/视频生成、任务列表 |
| 上游配置 | `/settings/upstreams` | 正常 | 9 个上游，支持禁用/置顶/删除 |
| 模型测试 | `/settings/model-test` | 正常 | 批量测试、历史记录 |
| 导入/导出 | `/settings/export` | 正常 | 助手、对话、上游配置 |
| Prompt 设置 | `/settings/prompts` | 正常 | 压缩/标题/开场白/优化 |
| MCP 接口 | `/settings/mcp` | 正常 | 5 个 MCP 服务，API 配置 |
| 通用设置 | `/settings/general` | 正常 | 绘图/视频/对话默认配置 |
| 回收站 | `/trash` | 正常 | 13 个已删除任务 |

### 待测试

| 页面 | 路由 | 优先级 |
|------|------|--------|
| 文档中心 | `/docs/` | 低 |

## 发现的问题

### 1. Hydration Mismatch 警告

> [!warning] 影响：中等
> 服务端渲染与客户端渲染不一致

**现象**：
- 对话页面和创作页面都有此警告
- 控制台显示多条 `Hydration node mismatch` 和 `Hydration children mismatch`

**可能原因**：
- 客户端和服务端渲染的 DOM 结构不一致
- 时间戳、随机数等动态内容未正确处理
- 条件渲染逻辑在 SSR 和 CSR 中表现不同

**建议**：
- 检查使用 `Date.now()` 或 `Math.random()` 的组件
- 检查 `v-if` 条件在服务端和客户端的值
- 使用 `<ClientOnly>` 包裹纯客户端组件

### 2. 耗时显示为 null

> [!bug] 影响：低
> 失败任务的耗时显示异常

**现象**：
- 创作页面失败的任务显示"耗时 null秒"

**位置**：
- ID:84 任务（即梦视频，请求超时）
- ID:73 任务（Sora，API 配额已用尽）

**建议**：
- 失败任务不显示耗时，或显示"--"

## 页面功能记录

### 对话页面 `/chat`

**布局结构**：
```
┌─────────────────────────────────────────────────────────────┐
│ Header: Logo | 创作 | 对话 | 文档 | 设置 | 主题切换 | 头像  │
├──────────┬──────────────────────────────┬───────────────────┤
│ 助手列表  │        对话区域              │    对话列表       │
│          │                              │                   │
│ - 收藏    │  话题建议                    │  当前助手信息     │
│ - 全部    │  输入框                      │  历史对话列表     │
│ - 新建    │  模型选择器                  │                   │
└──────────┴──────────────────────────────┴───────────────────┘
```

**主要功能**：
- [x] 助手列表显示（分收藏/全部）
- [x] 助手收藏/取消收藏
- [x] 新建助手
- [x] 话题建议（可换一批）
- [x] 模型选择
- [x] 对话列表显示
- [x] 编辑助手

**已测试（2026-01-29）**：
- [x] 发送消息 - 正常
- [x] 接收流式响应 - 正常，支持 Markdown 格式化
- [x] 多轮对话 - 正常
- [x] 模型切换 - 正常（从 gemini-3-flash 切换到 claude-sonnet-4）

**待测试**：
- [ ] 附件上传
- [ ] 对话删除
- [ ] 助手编辑保存

### 创作工作台 `/studio`

**布局结构**：
```
┌─────────────────────────────────────────────────────────────┐
│ Header                                                       │
├─────────────────────────────────────────────────────────────┤
│ 创作工作台                                    [帮助中心]     │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ [图片] [视频]                                           │ │
│ │ 选择模型: [选择模型 ▼]                                  │ │
│ │ 描述: [________________] [AI优化]                       │ │
│ │ [开始生成]                                              │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ 生成任务                    [模糊本页] [显示本页] [回收站]  │
│ 筛选: [工作台 ▼] [全部 ▼]  搜索: [____________]            │
├─────────────────────────────────────────────────────────────┤
│ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐                │
│ │ 图片1  │ │ 图片2  │ │ 图片3  │ │ 视频1  │ ...            │
│ │        │ │        │ │        │ │        │                │
│ │ 操作栏 │ │ 操作栏 │ │ 操作栏 │ │ 操作栏 │                │
│ └────────┘ └────────┘ └────────┘ └────────┘                │
│                                                             │
│ [分页器]                                                    │
└─────────────────────────────────────────────────────────────┘
```

**支持的模型**（根据任务记录）：
- 图片：Gemini 绘图、Gemini 3绘图、Flux、通义万相、Midjourney、Z-Image、豆包绘图、抠抠图
- 视频：Sora、即梦视频

**主要功能**：
- [x] 图片/视频模式切换
- [x] 模型选择
- [x] 提示词输入
- [x] AI 优化提示词
- [x] 参考图上传
- [x] 任务列表显示
- [x] 任务筛选（工作台/全部）
- [x] 任务搜索
- [x] 模糊/显示图片
- [x] 分页

**任务操作**：
- [x] 下载图片/视频
- [x] 放大查看/全屏查看
- [x] 详情
- [x] 复制到工作台
- [x] 删除
- [x] MJ 操作（仅 Midjourney）
- [x] 重试（失败任务）

## 下一步计划

1. ~~测试对话发送和响应~~ ✅ 已完成
2. ~~测试图片生成完整流程~~ ✅ 已完成
3. 编写详细测试用例

## 深度功能测试记录（2026-01-29）

### 对话功能测试

| 测试项 | 结果 | 备注 |
|-------|------|------|
| 发送消息 | ✅ 通过 | 消息即时显示，URL 更新为对话 ID |
| 流式响应 | ✅ 通过 | 响应逐字显示，支持 Markdown |
| 多轮对话 | ✅ 通过 | 上下文保持正常 |
| 模型切换 | ✅ 通过 | gemini-3-flash → claude-sonnet-4 |
| 消息计数 | ✅ 通过 | 实时更新消息数和字节数 |

### 图片生成测试

| 测试项 | 结果 | 备注 |
|-------|------|------|
| 模型选择 | ✅ 通过 | 多上游多模型选择器正常 |
| 提示词输入 | ✅ 通过 | 支持中文提示词 |
| 任务提交 | ✅ 通过 | 显示"提交中"状态 |
| 任务完成 | ✅ 通过 | ID:134，耗时 20 秒 |
| 任务计数 | ✅ 通过 | 46 → 47 个任务 |
| 任务删除 | ✅ 通过 | 确认对话框 → 删除成功 → 47 → 46 |

## 设置页面功能记录

### 上游配置 `/settings/upstreams`

**已配置上游**：
- cliproxy（1 绘图 + 15 对话模型）
- foxcode-droid（3 对话模型）
- OneAPI（3 绘图 + 7 对话模型）
- 云雾API（8 绘图 + 7 对话模型）
- 柏拉图AI（3 绘图 + 3 对话模型）
- GOGO API（5 绘图 + 1 对话模型）
- ephone（1 绘图 + 2 对话模型）
- gitee ai（1 绘图模型）
- 抠抠图（1 绘图模型）

**功能**：
- [x] 上游列表显示
- [x] 添加上游
- [x] 禁用/启用上游
- [x] 置顶上游
- [x] 删除上游
- [x] 平台类型识别（OneAPI）
- [x] 余额查询

### 模型测试 `/settings/model-test`

**功能**：
- [x] 模型分类筛选（对话/绘图/视频）
- [x] 模型名称筛选
- [x] 并发数设置（1-10）
- [x] 超时时间设置
- [x] 自定义测试提示词
- [x] 验证关键词
- [x] 批量选择（全选/选择失败）
- [x] 批量操作（重试/删除）
- [x] 历史记录查看

### MCP 接口 `/settings/mcp`

**已配置 MCP 服务**：
- mj-studio（HTTP，已启用）
- fetch（stdio，未启用）
- context7（stdio，已启用）
- serper（stdio，已启用）
- playwright（HTTP，已启用）

**MCP 接口功能**：
- [x] API Key 管理（查看/复制/重新生成）
- [x] 服务器 URL 配置
- [x] Claude Desktop 配置示例
- [x] 可用工具列表（对话/图片/视频）

### 回收站 `/trash`

**功能**：
- [x] 已删除任务列表
- [x] 任务恢复
- [x] 清空回收站
- [x] 任务计数

## 相关文档

- [Playwright 使用经验](./使用经验.md)
- [功能测试用例](./测试用例-功能测试.md)

---

## 文档与实际功能对比分析

### 文档覆盖情况

| 功能模块 | 文档 | 网站实现 | 一致性 |
|---------|------|---------|--------|
| 对话功能 | `对话功能介绍.md` | 完整实现 | 一致 |
| 生图功能 | `生图功能介绍.md` | 完整实现 | 一致 |
| 视频生成 | `视频生成功能介绍.md` | 完整实现 | 一致 |
| MCP 客户端 | `MCP客户端功能介绍.md` | 完整实现 | 一致 |
| MCP 接口 | `MCP接口功能介绍.md` | 完整实现 | 一致 |
| 上游配置 | `上游和模型配置.md` | 完整实现 | 一致 |
| 模型测试 | `模型可用性测试功能介绍.md` | 完整实现 | 一致 |
| 搜索功能 | `搜索功能介绍.md` | 完整实现 | 一致 |
| 思考功能 | `思考功能介绍.md` | 完整实现 | 一致 |
| 对话压缩 | `对话压缩功能介绍.md` | 完整实现 | 一致 |
| 数据导入导出 | `数据导入导出功能介绍.md` | 完整实现 | 一致 |
| 嵌入式绘图 | `嵌入式绘图组件介绍.md` | 完整实现 | 一致 |
| 多端同步 | `多端同步和流式输出.md` | 完整实现 | 一致 |

### 文档缺失的功能

以下网站功能在 `docs/features/` 中没有独立文档：

1. **Prompt 设置** - 对话压缩、标题生成、开场白建议、提示词优化的 Prompt 配置
2. **通用设置** - 绘图/视频/对话的默认配置
3. **回收站** - 已删除任务的恢复和清空

> 建议：这些功能相对简单，可以合并到现有文档或创建一个"系统设置"文档统一说明。

### 文档准确性

经过 Playwright 测试验证，现有文档描述与网站实际功能**高度一致**，未发现重大偏差。
