# 数据导入导出功能介绍

MJ-Studio 提供统一的数据导入导出系统，支持助手、对话、上游配置的选择性导出和批量导入，方便数据备份和配置分享。

## 功能入口

在「设置」页面点击「导入/导出」菜单项，进入统一的导入导出管理页面。

## 支持的数据类型

### 1. 助手

**导出内容**：
- 助手名称和描述
- 头像（自动转换为 Base64 编码）
- 系统提示词（System Prompt）
- 思考模式开关状态
- 关联的上游和模型信息（仅记录名称，用于导入时匹配）

**导入行为**：
- 创建新助手，不会覆盖现有助手
- 头像 Base64 自动保存为本地文件
- 根据上游名称和模型名称自动匹配 aimodelId
- 如果找不到匹配的模型，助手会创建但不关联模型

### 2. 对话

**导出内容**：
- 对话标题和创建时间
- 关联的助手名称
- 完整的消息列表（用户消息和 AI 回复）
- 消息的模型显示名称
- 消息标记（压缩请求、压缩摘要等特殊标记）

**导入行为**：
- 根据助手名称查找匹配的助手
- 创建新对话并逐条导入消息
- 保留消息的原始时间戳和标记
- 如果找不到匹配的助手，该对话会跳过并在控制台输出警告

**注意事项**：
- 导入对话前需先导入对应的助手
- 消息中的图片附件会重新上传到本地存储
- 导入不会覆盖现有对话，始终创建新对话

### 3. 上游配置

**导出内容**：
- 上游名称、API 地址、备注
- API 密钥列表（完整导出）
- 上游平台标识
- 用户 API Key（如果配置了）
- 关联的模型列表（包含模型类型、API 格式、模型名称等完整配置）

**导入行为**：
- 检查是否存在同名上游，存在则跳过
- 创建新上游配置及其关联的所有模型
- 保留原有的模型配置参数

**注意事项**：
- 同名上游配置不会重复导入
- API 密钥会完整导出，请妥善保管导出文件
- 导入后需要在上游配置页面验证连接是否正常

## 使用方法

### 导出数据

1. 进入「设置 > 导入/导出」页面
2. 在对应的区域勾选要导出的项目：
   - **助手区域**：勾选要导出的助手，支持全选
   - **对话区域**：先选择助手，加载其对话列表，然后勾选要导出的对话
   - **上游配置区域**：勾选要导出的上游配置，支持全选
3. 点击右上角的「导出选中」按钮
4. 系统会下载一个 JSON 文件，文件名格式：`mj-studio-export-YYYY-MM-DD.json`

### 导入数据

1. 进入「设置 > 导入/导出」页面
2. 点击右上角的「导入」按钮
3. 选择之前导出的 JSON 文件
4. 系统会自动识别文件内容并导入：
   - 先导入上游配置
   - 再导入助手（并尝试匹配模型）
   - 最后导入对话（并尝试匹配助手）
5. 导入完成后会显示成功导入的数量

## 导出文件格式

导出的 JSON 文件结构如下：

```json
{
  "version": 3,
  "exportedAt": "2026-01-19T10:00:00.000Z",
  "assistants": [
    {
      "name": "默认助手",
      "description": "通用智能助理",
      "avatar": "data:image/png;base64,...",
      "systemPrompt": "你是一个专业的 AI 助手...",
      "isDefault": false,
      "enableThinking": false,
      "upstreamName": "OpenAI 官方",
      "aimodelName": "GPT-4o"
    }
  ],
  "conversations": [
    {
      "assistantName": "默认助手",
      "title": "Vue 响应式原理讨论",
      "createdAt": "2026-01-19T09:00:00.000Z",
      "messages": [
        {
          "role": "user",
          "content": "帮我解释 Vue 的响应式原理",
          "modelDisplayName": null,
          "mark": null,
          "createdAt": "2026-01-19T09:00:00.000Z"
        },
        {
          "role": "assistant",
          "content": "Vue 的响应式系统基于...",
          "modelDisplayName": "GPT-4o",
          "mark": null,
          "createdAt": "2026-01-19T09:00:05.000Z"
        }
      ]
    }
  ],
  "upstreams": [
    {
      "name": "OpenAI 官方",
      "baseUrl": "https://api.openai.com",
      "apiKeys": ["sk-..."],
      "remark": "官方 API",
      "upstreamPlatform": "openai",
      "userApiKey": null,
      "aimodels": [
        {
          "category": "chat",
          "modelType": "gpt",
          "apiFormat": "openai",
          "modelName": "gpt-4o",
          "name": "GPT-4o",
          "estimatedTime": 5,
          "keyName": null
        }
      ]
    }
  ]
}
```

## 使用场景

### 数据备份

定期导出所有助手、对话和上游配置，作为数据备份。

### 分享配置

导出特定的助手和上游配置，分享给团队成员或其他用户，快速复制工作环境。

### 多账号数据迁移

在不同账号之间迁移数据，例如将个人账号的配置导入到团队账号。

### 测试环境同步

将生产环境的配置导出，导入到测试环境，保持配置一致性。

## 注意事项

### 安全性

- 导出文件包含完整的 API 密钥，请妥善保管
- 不要将导出文件上传到公共位置
- 分享配置时建议先删除敏感的 API 密钥

### 兼容性

- 导出文件版本号为 3，与旧版本格式不兼容
- 导入时会自动验证文件格式
- 如果格式不正确，会提示"无效的导入文件格式"

### 数据完整性

- 导入对话前需确保对应的助手已存在
- 导入助手时如果找不到匹配的模型，助手会创建但需要手动配置模型
- 同名上游配置不会重复导入，如需更新请先删除旧配置

### 资源处理

- 助手头像会自动转换为 Base64 编码
- 导入时 Base64 会自动保存为本地文件
- 消息中的图片附件会重新上传到本地存储

## 相关文档

- [对话功能介绍](./对话功能介绍.md)
- [上游和模型配置](./上游和模型配置.md)
