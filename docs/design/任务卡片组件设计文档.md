# ä»»åŠ¡å¡ç‰‡ç»„ä»¶è®¾è®¡æ–‡æ¡£

## æ¦‚è¿°

DrawingCard ç»„ä»¶ `app/components/drawing/Card.vue` æ˜¯ç»˜å›¾ä»»åŠ¡çš„å±•ç¤ºå¡ç‰‡ï¼Œè´Ÿè´£æ˜¾ç¤ºä»»åŠ¡çŠ¶æ€ã€å›¾ç‰‡é¢„è§ˆã€æ“ä½œæŒ‰é’®ç­‰ã€‚

## ç»„ä»¶ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å›¾ç‰‡é¢„è§ˆåŒº (aspect-square)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ æœ‰å›¾ç‰‡: æ˜¾ç¤ºå›¾ç‰‡ + æ£‹ç›˜æ ¼èƒŒæ™¯    â”‚â”‚
â”‚  â”‚ æ— å›¾ç‰‡: æ˜¾ç¤ºçŠ¶æ€å›¾æ ‡/åŠ è½½åŠ¨ç”»   â”‚â”‚
â”‚  â”‚                                 â”‚â”‚
â”‚  â”‚ [æ¨¡å‹æ ‡ç­¾]        [å‚è€ƒå›¾æŒ‰é’®]  â”‚â”‚
â”‚  â”‚ â•â•â•â•â•â•â•â•â•â•â•â• è¿›åº¦æ¡ â•â•â•â•â•â•â•â•â•â•â•â•â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä¿¡æ¯åŒº                              â”‚
â”‚  - ä»»åŠ¡ID + æ—¶é—´                     â”‚
â”‚  - æç¤ºè¯ï¼ˆå¯å±•å¼€ï¼‰                  â”‚
â”‚  - æ“ä½œæŒ‰é’®                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## çŠ¶æ€å®šä¹‰

### ä»»åŠ¡çŠ¶æ€ (TaskStatus)

| çŠ¶æ€ | è¯´æ˜ | å›¾æ ‡ | æ˜¾ç¤ºåŠ è½½åŠ¨ç”» |
|-----|------|------|-------------|
| `pending` | ç­‰å¾…æäº¤ | clock | å¦ |
| `submitting` | æ­£åœ¨æäº¤åˆ°ä¸Šæ¸¸ | - | æ˜¯ |
| `processing` | ä¸Šæ¸¸å¤„ç†ä¸­ | - | æ˜¯ |
| `success` | ç”ŸæˆæˆåŠŸ | check-circle | å¦ |
| `failed` | ç”Ÿæˆå¤±è´¥ | x-circle | å¦ |
| `cancelled` | å·²å–æ¶ˆ | no-symbol | å¦ |

### æ´¾ç”ŸçŠ¶æ€

| çŠ¶æ€ | è®¡ç®—é€»è¾‘ | ç”¨é€” |
|-----|---------|-----|
| `isLoading` | pending/submitting/processing | æ˜¾ç¤ºåŠ è½½åŠ¨ç”»ã€è¿›åº¦æ¡ |
| `isBlurred` | ç”¨æˆ·è®¾ç½® | å›¾ç‰‡æ¨¡ç³Šé®ç½© |
| `hasRefImages` | task.images.length > 0 | æ˜¾ç¤ºå‚è€ƒå›¾æŒ‰é’® |

## èƒŒæ™¯æ˜¾ç¤ºé€»è¾‘

| æ¡ä»¶ | èƒŒæ™¯æ ·å¼ |
|-----|---------|
| æœ‰å›¾ç‰‡ + æœªæ¨¡ç³Š | æ£‹ç›˜æ ¼èƒŒæ™¯ (checkerboard-bg) |
| æœ‰å›¾ç‰‡ + å·²æ¨¡ç³Š | çº¯è‰²èƒŒæ™¯ (bg-muted) |
| æ— å›¾ç‰‡ | çº¯è‰²èƒŒæ™¯ (bg-muted) |

## è¿›åº¦æ¡é€»è¾‘

### è®¡ç®—å…¬å¼

```
progressPercent = min(elapsed / (estimatedTime * 1.1) * 100, 100)
```

- `elapsed`: ä»ä»»åŠ¡åˆ›å»ºåˆ°ç°åœ¨çš„ç§’æ•°
- `estimatedTime`: é¢„è®¡ç”Ÿæˆæ—¶é—´ï¼ˆæ¥è‡ªæ¨¡å‹é…ç½®æˆ–é»˜è®¤ 60 ç§’ï¼‰
- `1.1`: ç¼“å†²ç³»æ•°ï¼Œé¿å…è¿›åº¦æ¡è¿‡æ—©åˆ°è¾¾ 100%

### å®šæ—¶å™¨ç®¡ç†

- `isLoading` ä¸º true æ—¶å¯åŠ¨å®šæ—¶å™¨ï¼ˆ500ms é—´éš”ï¼‰
- `isLoading` ä¸º false æ—¶æ¸…é™¤å®šæ—¶å™¨
- ç»„ä»¶å¸è½½æ—¶æ¸…é™¤å®šæ—¶å™¨

## æ“ä½œæŒ‰é’®

### MJ ä¸“å±æŒ‰é’®ï¼ˆä» task.buttons è§£æï¼‰

| ç±»å‹ | æŒ‰é’® | å›¾æ ‡ |
|-----|------|-----|
| æ”¾å¤§ | U1-U4 | arrows-pointing-out |
| å˜ä½“ | V1-V4 | sparkles |
| é‡ç»˜ | ğŸ”„ | arrow-path |

### é€šç”¨æŒ‰é’®

| æŒ‰é’® | æ¡ä»¶ | æ“ä½œ |
|-----|------|-----|
| å¤åˆ¶åˆ°å·¥ä½œå° | å§‹ç»ˆ | emit('copyToPanel') |
| é‡è¯• | failed çŠ¶æ€ | emit('retry') |
| å–æ¶ˆ | loading çŠ¶æ€ | emit('cancel') |
| åˆ é™¤ | å§‹ç»ˆ | emit('remove') |
| æŸ¥çœ‹æ—¥å¿— | failed çŠ¶æ€ | æ‰“å¼€æ—¥å¿—å¼¹çª— |

## å¼¹çª—

| å¼¹çª— | è§¦å‘ | å†…å®¹ |
|-----|------|-----|
| å›¾ç‰‡é¢„è§ˆ | ç‚¹å‡»å›¾ç‰‡ | å¤§å›¾ + ä¸‹è½½æŒ‰é’® |
| å‚è€ƒå›¾ | ç‚¹å‡»å‚è€ƒå›¾æŒ‰é’® | å‚è€ƒå›¾åˆ—è¡¨ |
| ä»»åŠ¡è¯¦æƒ… | ç‚¹å‡»è¯¦æƒ…æŒ‰é’® | å®Œæ•´ä»»åŠ¡ä¿¡æ¯ |
| é”™è¯¯æ—¥å¿— | ç‚¹å‡»æŸ¥çœ‹æ—¥å¿— | è¯·æ±‚/å“åº”æ—¥å¿— |

## äº‹ä»¶

| äº‹ä»¶ | å‚æ•° | è¯´æ˜ |
|-----|------|-----|
| `action` | customId | MJ æŒ‰é’®æ“ä½œ |
| `remove` | - | åˆ é™¤ä»»åŠ¡ |
| `retry` | - | é‡è¯•ä»»åŠ¡ |
| `cancel` | - | å–æ¶ˆä»»åŠ¡ |
| `blur` | isBlurred | åˆ‡æ¢æ¨¡ç³ŠçŠ¶æ€ |
| `copyToPanel` | prompt, negativePrompt, images | å¤åˆ¶åˆ°å·¥ä½œå° |

## é‡æ„å»ºè®®

### å½“å‰é—®é¢˜

1. **ä»£ç é‡å¤§**ï¼šå•æ–‡ä»¶ 660+ è¡Œï¼ŒèŒè´£è¿‡å¤š
2. **å¼¹çª—é€»è¾‘æ··æ‚**ï¼š4 ä¸ªå¼¹çª—çš„çŠ¶æ€å’Œé€»è¾‘éƒ½åœ¨ä¸»ç»„ä»¶ä¸­
3. **æ ·å¼åˆ†æ•£**ï¼šéƒ¨åˆ†æ ·å¼åœ¨ templateï¼Œéƒ¨åˆ†åœ¨ style

### å»ºè®®æ‹†åˆ†

```
drawing/
â”œâ”€â”€ Card.vue              # ä¸»ç»„ä»¶ï¼ˆç²¾ç®€ï¼‰
â”œâ”€â”€ CardImage.vue         # å›¾ç‰‡é¢„è§ˆåŒºï¼ˆå«æ£‹ç›˜æ ¼èƒŒæ™¯ï¼‰
â”œâ”€â”€ CardInfo.vue          # ä¿¡æ¯åŒº
â”œâ”€â”€ CardActions.vue       # æ“ä½œæŒ‰é’®
â”œâ”€â”€ CardProgress.vue      # è¿›åº¦æ¡
â”œâ”€â”€ modals/
â”‚   â”œâ”€â”€ ImagePreview.vue  # å›¾ç‰‡é¢„è§ˆå¼¹çª—
â”‚   â”œâ”€â”€ RefImages.vue     # å‚è€ƒå›¾å¼¹çª—
â”‚   â”œâ”€â”€ TaskDetail.vue    # ä»»åŠ¡è¯¦æƒ…å¼¹çª—
â”‚   â””â”€â”€ ErrorLogs.vue     # é”™è¯¯æ—¥å¿—å¼¹çª—
```

### çŠ¶æ€ç®¡ç†ä¼˜åŒ–

å°†è¿›åº¦æ¡å®šæ—¶å™¨é€»è¾‘æŠ½å–ä¸º composableï¼š

```typescript
// useTaskProgress.ts
export function useTaskProgress(task: Ref<Task>) {
  const isLoading = computed(...)
  const progressPercent = computed(...)
  // è‡ªåŠ¨ç®¡ç†å®šæ—¶å™¨
  return { isLoading, progressPercent }
}
```
