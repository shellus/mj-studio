# æ¨¡å‹é€‰æ‹©å™¨ç»„ä»¶è®¾è®¡æ–‡æ¡£

## æ¦‚è¿°

`ModelSelector` æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„æ¨¡å‹é€‰æ‹©ç»„ä»¶ï¼Œç”¨äºå¯¹è¯ã€ç»˜å›¾ã€è§†é¢‘ç­‰åœºæ™¯ä¸‹çš„æ¨¡å‹é€‰æ‹©ã€‚ç»„ä»¶é€šè¿‡ `category` å‚æ•°åŒºåˆ†ä¸åŒæ¨¡å‹ç±»å‹ï¼Œè‡ªåŠ¨è¿‡æ»¤å’Œå±•ç¤ºå¯¹åº”çš„æ¨¡å‹åˆ—è¡¨ã€‚

## ç»„ä»¶èŒè´£

- **æ¨¡å‹è¿‡æ»¤**ï¼šæ ¹æ® `category` å‚æ•°è¿‡æ»¤ç¬¦åˆæ¡ä»¶çš„ AI æ¨¡å‹
- **åˆ†ç»„å±•ç¤º**ï¼šæŒ‰ä¸Šæ¸¸é…ç½®åˆ†ç»„å±•ç¤ºæ¨¡å‹ï¼Œæ¯ç»„æ˜¾ç¤ºä¸Šæ¸¸åç§°å’Œè®¾ç½®å…¥å£
- **åŒå‘ç»‘å®š**ï¼šé€šè¿‡ `v-model` ç»‘å®šé€‰ä¸­çš„ä¸Šæ¸¸ ID å’Œæ¨¡å‹ ID
- **è‡ªåŠ¨é€‰æ‹©**ï¼šé¦–æ¬¡æ¸²æŸ“æ—¶è‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªå¯ç”¨æ¨¡å‹ï¼ˆå¯ç¦ç”¨ï¼‰
- **æš´éœ²æ•°æ®**ï¼šé€šè¿‡ `defineExpose` å‘çˆ¶ç»„ä»¶æä¾›å®Œæ•´çš„ Upstream å’Œ Aimodel å¯¹è±¡

## æ¶æ„è®¾è®¡

### æ ¸å¿ƒæµç¨‹

```
ç”¨æˆ·é…ç½®ä¸Šæ¸¸ â†’ useUpstreams åŠ è½½æ•°æ® â†’ ModelSelector è¿‡æ»¤åˆ†ç»„ â†’ ç”¨æˆ·é€‰æ‹©æ¨¡å‹ â†’ åŒå‘ç»‘å®šæ›´æ–°
                                                                    â†“
                                              çˆ¶ç»„ä»¶é€šè¿‡ ref è®¿é—® selectedUpstream/selectedAimodel
```

### æ•°æ®æµè½¬

```typescript
// 1. çˆ¶ç»„ä»¶ä¼ å…¥ä¸Šæ¸¸åˆ—è¡¨
const { upstreams } = useUpstreams()

// 2. ModelSelector å†…éƒ¨è¿‡æ»¤
groupedModels = upstreams
  .filter(category åŒ¹é…)
  .groupBy(upstreamId)

// 3. ç”¨æˆ·é€‰æ‹©ååŒå‘ç»‘å®š
emit('update:upstreamId', newId)
emit('update:aimodelId', newId)

// 4. çˆ¶ç»„ä»¶é€šè¿‡ ref è·å–å®Œæ•´å¯¹è±¡
const { selectedUpstream, selectedAimodel } = modelSelectorRef.value
```

## API è®¾è®¡

### Props

| å±æ€§ | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|-----|------|------|--------|------|
| `upstreams` | `Upstream[]` | âœ… | - | ä¸Šæ¸¸é…ç½®åˆ—è¡¨ï¼ˆå« aimodels å­è¡¨ï¼‰ |
| `category` | `ModelCategory` | âœ… | - | æ¨¡å‹åˆ†ç±»ï¼š`'chat'` \| `'image'` \| `'video'` |
| `upstreamId` | `number \| null` | âŒ | `null` | é€‰ä¸­çš„ä¸Šæ¸¸ IDï¼ˆåŒå‘ç»‘å®šï¼‰ |
| `aimodelId` | `number \| null` | âŒ | `null` | é€‰ä¸­çš„ AI æ¨¡å‹ IDï¼ˆåŒå‘ç»‘å®šï¼‰ |
| `showTypeLabel` | `boolean` | âŒ | `false` | æ˜¾ç¤ºæ¨¡å‹ç±»å‹æ ‡ç­¾è€Œéæ¨¡å‹åç§° |
| `dropdownWidth` | `string` | âŒ | `'w-80'` | ä¸‹æ‹‰é¢æ¿å®½åº¦ï¼ˆTailwindCSS classï¼‰ |
| `listLayout` | `boolean` | âŒ | `false` | ä½¿ç”¨åˆ—è¡¨å¸ƒå±€è€Œé grid å¸ƒå±€ |
| `noAutoSelect` | `boolean` | âŒ | `false` | ç¦ç”¨è‡ªåŠ¨é€‰æ‹©é»˜è®¤é…ç½® |
| `alignRight` | `boolean` | âŒ | `false` | ä¸‹æ‹‰æ¡†å³å¯¹é½ï¼ˆå‘å·¦å±•å¼€ï¼‰ |

### Emits

| äº‹ä»¶ | å‚æ•° | è¯´æ˜ |
|-----|------|------|
| `update:upstreamId` | `id: number \| null` | ä¸Šæ¸¸ ID å˜åŒ– |
| `update:aimodelId` | `id: number \| null` | AI æ¨¡å‹ ID å˜åŒ– |

### Expose

| å±æ€§ | ç±»å‹ | è¯´æ˜ |
|-----|------|------|
| `selectedUpstream` | `ComputedRef<Upstream \| undefined>` | å½“å‰é€‰ä¸­çš„ä¸Šæ¸¸é…ç½®å¯¹è±¡ |
| `selectedAimodel` | `ComputedRef<Aimodel \| undefined>` | å½“å‰é€‰ä¸­çš„ AI æ¨¡å‹å¯¹è±¡ |

## ä½¿ç”¨åœºæ™¯

### å¯¹è¯åœºæ™¯

```vue
<script setup lang="ts">
const { upstreams, loadUpstreams } = useUpstreams()
const selectedUpstreamId = ref<number | null>(null)
const selectedAimodelId = ref<number | null>(null)

onMounted(() => loadUpstreams())
</script>

<template>
  <ModelSelector
    :upstreams="upstreams"
    category="chat"
    v-model:upstream-id="selectedUpstreamId"
    v-model:aimodel-id="selectedAimodelId"
  />
</template>
```

### ç»˜å›¾åœºæ™¯

```vue
<script setup lang="ts">
const { upstreams, loadUpstreams } = useUpstreams()
const selectedUpstreamId = ref<number | null>(null)
const selectedAimodelId = ref<number | null>(null)
const modelSelectorRef = ref()

// è·å–é€‰ä¸­æ¨¡å‹çš„å®Œæ•´ä¿¡æ¯
const selectedAimodel = computed(() => modelSelectorRef.value?.selectedAimodel)
const selectedUpstream = computed(() => modelSelectorRef.value?.selectedUpstream)

// æäº¤æ—¶ä½¿ç”¨å®Œæ•´å¯¹è±¡
function handleSubmit() {
  if (!selectedAimodel.value || !selectedUpstream.value) return

  const data = {
    upstreamId: selectedUpstream.value.id,
    aimodelId: selectedAimodel.value.id,
    modelType: selectedAimodel.value.modelType,
    apiFormat: selectedAimodel.value.apiFormat,
    modelName: selectedAimodel.value.modelName,
    // ...
  }
}

onMounted(() => loadUpstreams())
</script>

<template>
  <ModelSelector
    ref="modelSelectorRef"
    :upstreams="upstreams"
    category="image"
    v-model:upstream-id="selectedUpstreamId"
    v-model:aimodel-id="selectedAimodelId"
  />
</template>
```

### è§†é¢‘åœºæ™¯

```vue
<script setup lang="ts">
const { upstreams, loadUpstreams } = useUpstreams()
const selectedUpstreamId = ref<number | null>(null)
const selectedAimodelId = ref<number | null>(null)
const modelSelectorRef = ref()

// æ ¹æ®æ¨¡å‹ç±»å‹åŠ¨æ€æ˜¾ç¤ºå‚æ•°è¡¨å•
const selectedModelType = computed(() => modelSelectorRef.value?.selectedAimodel?.modelType)

onMounted(() => loadUpstreams())
</script>

<template>
  <ModelSelector
    ref="modelSelectorRef"
    :upstreams="upstreams"
    category="video"
    v-model:upstream-id="selectedUpstreamId"
    v-model:aimodel-id="selectedAimodelId"
  />

  <!-- æ ¹æ®æ¨¡å‹ç±»å‹æ˜¾ç¤ºä¸åŒçš„å‚æ•°è¡¨å• -->
  <div v-if="selectedModelType === 'jimeng-video'">
    <!-- å³æ¢¦å‚æ•° -->
  </div>
  <div v-else-if="selectedModelType === 'veo'">
    <!-- Veo å‚æ•° -->
  </div>
  <div v-else-if="selectedModelType === 'sora'">
    <!-- Sora å‚æ•° -->
  </div>
</template>
```

## äº¤äº’é€»è¾‘

### æ¨¡å‹åˆ†ç±»è¿‡æ»¤

ç»„ä»¶é€šè¿‡ `filterModelsByCategory()` å‡½æ•°æ ¹æ® `category` prop è¿‡æ»¤ AI æ¨¡å‹ï¼š

**å¯¹è¯æ¨¡å‹ (`category="chat"`)**
- ä¼˜å…ˆåŒ¹é… `aimodel.category === 'chat'`
- å…¼å®¹æ—§æ•°æ®ï¼š`apiFormat === 'openai-chat'` ä¸”ä¸æ˜¯å›¾ç‰‡æ¨¡å‹ç±»å‹

**ç»˜å›¾æ¨¡å‹ (`category="image"`)**
- ä¼˜å…ˆåŒ¹é… `aimodel.category === 'image'`
- å…¼å®¹æ—§æ•°æ®ï¼šæ ¹æ® `modelType` åˆ¤æ–­ï¼ˆmidjourneyã€geminiã€fluxã€dalle ç­‰ï¼‰

**è§†é¢‘æ¨¡å‹ (`category="video"`)**
- åŒ¹é… `aimodel.category === 'video'`

```typescript
function filterModelsByCategory(aimodels: Aimodel[]): Aimodel[] {
  return aimodels.filter(m => {
    if (props.category === 'image') {
      return m.category === 'image' || (!m.category && isImageModelType(m.modelType))
    } else if (props.category === 'video') {
      return m.category === 'video'
    } else {
      return m.category === 'chat' ||
        (!m.category && m.apiFormat === 'openai-chat' && !isImageModelType(m.modelType))
    }
  })
}
```

### è‡ªåŠ¨é€‰æ‹©ç­–ç•¥

**è§¦å‘æ—¶æœº**ï¼š`upstreams` prop å˜åŒ–æ—¶

**é€‰æ‹©é€»è¾‘**ï¼š
1. æ£€æŸ¥ `noAutoSelect` propï¼Œå¦‚æœä¸º `true` åˆ™è·³è¿‡
2. å¦‚æœå½“å‰æ²¡æœ‰é€‰ä¸­ä¸Šæ¸¸ï¼ˆ`selectedUpstreamId.value` ä¸º `null`ï¼‰
3. é€‰æ‹©ç¬¬ä¸€ä¸ªåŒ…å«å¯ç”¨æ¨¡å‹çš„ä¸Šæ¸¸ï¼ˆupstreams å·²æŒ‰ `sortOrder` æ’åºï¼‰
4. é€‰æ‹©è¯¥ä¸Šæ¸¸ä¸‹çš„ç¬¬ä¸€ä¸ªç¬¦åˆ `category` çš„æ¨¡å‹

**éªŒè¯é€»è¾‘**ï¼šå½“é€‰ä¸­çš„ä¸Šæ¸¸å˜åŒ–æ—¶ï¼Œæ£€æŸ¥å½“å‰æ¨¡å‹æ˜¯å¦ä»ç„¶æœ‰æ•ˆï¼Œæ— æ•ˆåˆ™è‡ªåŠ¨åˆ‡æ¢åˆ°ç¬¬ä¸€ä¸ªå¯ç”¨æ¨¡å‹

```typescript
watch(() => props.upstreams, (upstreams) => {
  if (props.noAutoSelect) return
  if (upstreams.length > 0 && !selectedUpstreamId.value) {
    const firstUpstream = upstreams[0]
    const filteredModels = filterModelsByCategory(firstUpstream.aimodels || [])
    if (filteredModels.length > 0) {
      handleSelectModel(firstUpstream.id, filteredModels[0].id)
    }
  }
}, { immediate: true })
```

### ä¸‹æ‹‰æ¡†äº¤äº’

**å¼¹å‡ºæ–¹å‘è®¡ç®—**ï¼š
- æ‰“å¼€ä¸‹æ‹‰æ¡†å‰è®¡ç®—å¯ç”¨ç©ºé—´
- å¦‚æœä¸‹æ–¹ç©ºé—´ < 320px ä¸”ä¸Šæ–¹ç©ºé—´æ›´å¤§ï¼Œåˆ™å‘ä¸Šå¼¹å‡ºï¼ˆ`dropUp = true`ï¼‰
- å¦åˆ™å‘ä¸‹å¼¹å‡ºï¼ˆé»˜è®¤ï¼‰

**å…³é—­é€»è¾‘**ï¼š
- ç‚¹å‡»å¤–éƒ¨åŒºåŸŸå…³é—­ï¼ˆ`onClickOutside`ï¼‰
- é€‰æ‹©æ¨¡å‹åè‡ªåŠ¨å…³é—­

**å¯¹é½æ–¹å¼**ï¼š
- é»˜è®¤å·¦å¯¹é½ï¼ˆ`left-0`ï¼‰
- `alignRight` ä¸º `true` æ—¶å³å¯¹é½ï¼ˆ`right-0`ï¼‰

### ç©ºçŠ¶æ€å¤„ç†

**æ— ä¸Šæ¸¸é…ç½®**ï¼šæ˜¾ç¤ºæç¤ºæ–‡æœ¬ï¼Œå¼•å¯¼ç”¨æˆ·å‰å¾€è®¾ç½®é¡µæ·»åŠ æ¨¡å‹

```vue
<div class="text-xs text-(--ui-text-muted)">
  <UIcon name="i-heroicons-exclamation-circle" />
  è¯·å…ˆåœ¨è®¾ç½®ä¸­æ·»åŠ {{ category === 'chat' ? 'å¯¹è¯' : category === 'video' ? 'è§†é¢‘' : 'ç»˜å›¾' }}æ¨¡å‹
</div>
```

**æœ‰ä¸Šæ¸¸ä½†æ— å¯ç”¨æ¨¡å‹**ï¼šè§¦å‘æŒ‰é’®ç¦ç”¨ï¼Œä¸‹æ‹‰æ¡†ä¸å±•å¼€

## å±•ç¤ºå½¢å¼

### è§¦å‘æŒ‰é’®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [CPUå›¾æ ‡] ä¸Šæ¸¸A / gpt-4o            [ä¸‹æ‹‰ç®­å¤´] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- å·¦ä¾§æ˜¾ç¤º CPU å›¾æ ‡ + å½“å‰é€‰ä¸­çš„ä¸Šæ¸¸å/æ¨¡å‹å
- å³ä¾§æ˜¾ç¤ºä¸‹æ‹‰ç®­å¤´ï¼Œæ‰“å¼€æ—¶æ—‹è½¬ 180Â°
- æ— é€‰ä¸­æ—¶æ˜¾ç¤º"é€‰æ‹©æ¨¡å‹"

### ä¸‹æ‹‰é¢æ¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸Šæ¸¸A                      [âš™ï¸]  â”‚  â† åˆ†ç»„æ ‡é¢˜ + è®¾ç½®æŒ‰é’®
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚ âœ¨ gpt-4o â”‚ âœ¨ gpt-4o â”‚       â”‚  â† Grid å¸ƒå±€ï¼ˆé»˜è®¤ï¼‰
â”‚ â”‚          mini        â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä¸Šæ¸¸B                      [âš™ï¸]  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚ ğŸ¨ claude-3-opus       â”‚       â”‚  â† List å¸ƒå±€ï¼ˆlistLayout=trueï¼‰
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚ â”‚ ğŸ¨ claude-3-sonnet     â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åˆ†ç»„æ ‡é¢˜**ï¼š
- ç°è‰²èƒŒæ™¯åŒºåˆ†
- æ˜¾ç¤ºä¸Šæ¸¸åç§°
- å³ä¾§è®¾ç½®æŒ‰é’®è·³è½¬åˆ° `/settings/upstreams/{id}`

**æ¨¡å‹åˆ—è¡¨**ï¼š
- é»˜è®¤ Grid 2 åˆ—å¸ƒå±€ï¼ˆ`grid-cols-2`ï¼‰
- `listLayout` ä¸º `true` æ—¶ä½¿ç”¨åˆ—è¡¨å¸ƒå±€
- é€‰ä¸­é¡¹é«˜äº®æ˜¾ç¤ºï¼ˆä¸»é¢˜è‰²èƒŒæ™¯ï¼‰
- æ˜¾ç¤ºæ¨¡å‹ç±»å‹å›¾æ ‡ï¼ˆä» `MODEL_TYPE_ICONS` è·å–ï¼‰

**æ¨¡å‹æ˜¾ç¤ºæ–‡æœ¬**ï¼š
- é»˜è®¤æ˜¾ç¤º `modelName`
- `showTypeLabel` ä¸º `true` æ—¶æ˜¾ç¤º `MODEL_TYPE_LABELS[modelType]`ï¼ˆç”¨äºé€šç”¨é€‰æ‹©å™¨åœºæ™¯ï¼‰

## æŠ€æœ¯ç»†èŠ‚

### å“åº”å¼æ•°æ®æµ

```typescript
// 1. Props åˆ°å†…éƒ¨çŠ¶æ€çš„å•å‘æµ
watch(() => props.upstreamId, (val) => {
  selectedUpstreamId.value = val ?? null
})

// 2. å†…éƒ¨çŠ¶æ€åˆ° Emits çš„å•å‘æµ
function handleSelectModel(upstreamId: number, aimodelId: number) {
  selectedUpstreamId.value = upstreamId
  selectedAimodelId.value = aimodelId
  emit('update:upstreamId', upstreamId)
  emit('update:aimodelId', aimodelId)
}

// 3. è®¡ç®—å±æ€§èšåˆæ•°æ®
const selectedUpstream = computed(() => {
  return props.upstreams.find(u => u.id === selectedUpstreamId.value)
})

const selectedAimodel = computed(() => {
  if (!selectedUpstream.value || !selectedAimodelId.value) return undefined
  return selectedUpstream.value.aimodels?.find(m => m.id === selectedAimodelId.value)
})
```

### åˆ†ç»„è®¡ç®—é€»è¾‘

```typescript
const groupedModels = computed(() => {
  const groups: Array<{
    upstreamId: number
    upstreamName: string
    aimodels: Aimodel[]
  }> = []

  for (const upstream of props.upstreams) {
    const filteredModels = filterModelsByCategory(upstream.aimodels || [])
    if (filteredModels.length > 0) {
      groups.push({
        upstreamId: upstream.id,
        upstreamName: upstream.name,
        aimodels: filteredModels
      })
    }
  }

  return groups
})
```

### æ ·å¼å˜é‡

ç»„ä»¶ä½¿ç”¨ CSS å˜é‡ç¡®ä¿æ·±è‰²æ¨¡å¼å…¼å®¹ï¼š

| CSS å˜é‡ | ç”¨é€” |
|---------|------|
| `--ui-border` | è¾¹æ¡†é¢œè‰² |
| `--ui-bg` | é»˜è®¤èƒŒæ™¯è‰² |
| `--ui-bg-elevated` | æ‚¬æµ®å…ƒç´ èƒŒæ™¯è‰²ï¼ˆä¸‹æ‹‰é¢æ¿ï¼‰ |
| `--ui-bg-muted` | æ¬¡è¦èƒŒæ™¯è‰²ï¼ˆåˆ†ç»„æ ‡é¢˜ï¼‰ |
| `--ui-bg-accented` | å¼ºè°ƒèƒŒæ™¯è‰²ï¼ˆæ‚¬åœçŠ¶æ€ï¼‰ |
| `--ui-text` | æ–‡æœ¬é¢œè‰² |
| `--ui-text-muted` | æ¬¡è¦æ–‡æœ¬é¢œè‰² |
| `--ui-primary` | ä¸»é¢˜è‰²ï¼ˆé€‰ä¸­çŠ¶æ€ï¼‰ |

## ä¸ Composables çš„åä½œ

### useUpstreams

`ModelSelector` ä¾èµ– `useUpstreams` æä¾›çš„æ•°æ®ç»“æ„ï¼š

```typescript
interface Upstream {
  id: number
  name: string
  baseUrl: string
  apiKey: string
  sortOrder: number
  aimodels: Aimodel[]  // â† å¿…é¡»åŒ…å«å­è¡¨æ•°æ®
}

interface Aimodel {
  id: number
  upstreamId: number
  category: ModelCategory  // 'chat' | 'image' | 'video'
  modelType: ModelType
  apiFormat: ApiFormat
  modelName: string
  estimatedTime: number
  keyName: string
}
```

**å…³é”®ç‚¹**ï¼š
- `upstreams` å¿…é¡»é€šè¿‡ `loadUpstreams()` åŠ è½½ï¼Œç¡®ä¿åŒ…å« `aimodels` å­è¡¨
- åç«¯ API `/api/upstreams` è‡ªåŠ¨æŒ‰ `sortOrder` æ’åº
- ç»„ä»¶å†…éƒ¨ä¸å†æ’åºï¼Œç›´æ¥ä½¿ç”¨ä¼ å…¥çš„é¡ºåº

### useChatModels

å¯¹è¯åœºæ™¯å¯ä½¿ç”¨ `useChatModels` é¢„è¿‡æ»¤æ•°æ®ï¼ˆå¯é€‰ä¼˜åŒ–ï¼‰ï¼š

```typescript
const { chatModelConfigs } = useChatModels()

// chatModelConfigs è¿”å›æ‰å¹³åŒ–çš„ { upstream, aimodel } åˆ—è¡¨
// ä½† ModelSelector éœ€è¦åµŒå¥—çš„ Upstream[] æ ¼å¼ï¼Œæ‰€ä»¥ä¸€èˆ¬ç›´æ¥ä¼  upstreams
```

**æ³¨æ„**ï¼š`useChatModels` æ˜¯ä¸ºæ—©æœŸå¯¹è¯é¡µé¢è®¾è®¡çš„è¾…åŠ©å‡½æ•°ï¼Œç°åœ¨æœ‰äº† `ModelSelector` åå¯ä»¥ä¸å†ä½¿ç”¨ã€‚

## æœ€ä½³å®è·µ

### 1. å§‹ç»ˆä½¿ç”¨ ref è®¿é—®å®Œæ•´å¯¹è±¡

```vue
<script setup lang="ts">
const modelSelectorRef = ref()

// âœ… æ¨èï¼šé€šè¿‡ ref è·å–å®Œæ•´å¯¹è±¡
const selectedAimodel = computed(() => modelSelectorRef.value?.selectedAimodel)

// âŒ ä¸æ¨èï¼šæ‰‹åŠ¨ä» upstreams ä¸­æŸ¥æ‰¾
const selectedAimodel = computed(() => {
  const upstream = upstreams.value.find(u => u.id === selectedUpstreamId.value)
  return upstream?.aimodels.find(m => m.id === selectedAimodelId.value)
})
</script>

<template>
  <ModelSelector ref="modelSelectorRef" ... />
</template>
```

### 2. æ ¹æ®åœºæ™¯é€‰æ‹©å¸ƒå±€

```vue
<!-- å¯¹è¯åœºæ™¯ï¼šGrid å¸ƒå±€ï¼Œå®½åº¦ 320px -->
<ModelSelector
  :upstreams="upstreams"
  category="chat"
  dropdown-width="w-80"
/>

<!-- ç»˜å›¾åœºæ™¯ï¼šList å¸ƒå±€ï¼Œæ˜¾ç¤ºæ¨¡å‹ç±»å‹æ ‡ç­¾ -->
<ModelSelector
  :upstreams="upstreams"
  category="image"
  list-layout
  show-type-label
  dropdown-width="w-96"
/>

<!-- å°å±å¹•åœºæ™¯ï¼šå³å¯¹é½é˜²æ­¢æº¢å‡º -->
<ModelSelector
  :upstreams="upstreams"
  category="chat"
  align-right
  class="md:hidden"
/>
```

### 3. å¤„ç†ç©ºçŠ¶æ€

```vue
<script setup lang="ts">
const { upstreams, loadUpstreams } = useUpstreams()
const modelSelectorRef = ref()

const hasValidModel = computed(() => {
  return modelSelectorRef.value?.selectedAimodel !== undefined
})

onMounted(() => loadUpstreams())
</script>

<template>
  <ModelSelector ref="modelSelectorRef" ... />

  <UButton
    :disabled="!hasValidModel"
    @click="handleSubmit"
  >
    æäº¤
  </UButton>
</template>
```

### 4. ç¦ç”¨è‡ªåŠ¨é€‰æ‹©ï¼ˆé«˜çº§åœºæ™¯ï¼‰

```vue
<script setup lang="ts">
// ä» URL å‚æ•°æ¢å¤é€‰æ‹©
const route = useRoute()
const selectedUpstreamId = ref(Number(route.query.upstream) || null)
const selectedAimodelId = ref(Number(route.query.model) || null)
</script>

<template>
  <ModelSelector
    :upstreams="upstreams"
    category="chat"
    v-model:upstream-id="selectedUpstreamId"
    v-model:aimodel-id="selectedAimodelId"
    no-auto-select
  />
</template>
```

## å…¼å®¹æ€§è¯´æ˜

### æ—§æ•°æ®å…¼å®¹

ç»„ä»¶å…¼å®¹ `aimodels` è¡¨ä¸­æ²¡æœ‰ `category` å­—æ®µçš„æ—§æ•°æ®ï¼š

- **å¯¹è¯æ¨¡å‹**ï¼šæ£€æŸ¥ `apiFormat === 'openai-chat'` ä¸”ä¸æ˜¯å›¾ç‰‡æ¨¡å‹ç±»å‹
- **ç»˜å›¾æ¨¡å‹**ï¼šæ£€æŸ¥ `modelType` æ˜¯å¦åœ¨å›¾ç‰‡æ¨¡å‹ç±»å‹åˆ—è¡¨ä¸­ï¼ˆmidjourneyã€geminiã€flux ç­‰ï¼‰

æ–°æ•°æ®åº”å§‹ç»ˆè®¾ç½® `category` å­—æ®µï¼ˆ`chat` | `image` | `video`ï¼‰ã€‚

### æœªæ¥æ‰©å±•

ç»„ä»¶è®¾è®¡æ”¯æŒæ–°å¢æ¨¡å‹åˆ†ç±»ï¼š

1. åœ¨ `shared/types.ts` ä¸­æ·»åŠ æ–°çš„ `ModelCategory` å€¼
2. åœ¨ `filterModelsByCategory()` ä¸­æ·»åŠ å¯¹åº”çš„è¿‡æ»¤é€»è¾‘
3. åœ¨ `shared/constants.ts` ä¸­æ·»åŠ ç›¸å…³çš„å›¾æ ‡å’Œæ ‡ç­¾æ˜ å°„
4. çˆ¶ç»„ä»¶ä¼ å…¥æ–°çš„ `category` å€¼å³å¯

ç¤ºä¾‹ï¼šæ·»åŠ éŸ³é¢‘æ¨¡å‹æ”¯æŒ

```typescript
// types.ts
export type ModelCategory = 'chat' | 'image' | 'video' | 'audio'

// ModelSelector.vue
function filterModelsByCategory(aimodels: Aimodel[]): Aimodel[] {
  return aimodels.filter(m => {
    // ...
    else if (props.category === 'audio') {
      return m.category === 'audio'
    }
  })
}
```
